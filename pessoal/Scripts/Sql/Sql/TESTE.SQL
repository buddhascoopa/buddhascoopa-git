SET SERVEROUTPUT ON
DECLARE
I INTEGER;
P INTEGER;
BEGIN
SELECT N1 INTO I FROM TESTE.LOG WHERE C1 = 'T1';
--DBMS_SQL.CLOSE_CURSOR(I);
IF dbms_sql.is_open(I) THEN
   DBMS_OUTPUT.PUT_LINE(1);
   P:=DBMS_SQL.EXECUTE(I);
   DBMS_OUTPUT.PUT_LINE(P);
ELSE
   I := DBMS_SQL.OPEN_CURSOR;
   DBMS_SQL.PARSE(I, 'BEGIN TESTE.T1; END;',DBMS_SQL.V7);
   P:=DBMS_SQL.EXECUTE(I);
   DELETE FROM TESTE.LOG WHERE C1 = 'T1';
   INSERT INTO TESTE.LOG VALUES (I,'T1');
   COMMIT;
END IF;
EXCEPTION
   WHEN NO_DATA_FOUND THEN
   I := DBMS_SQL.OPEN_CURSOR;
   DBMS_SQL.PARSE(I, 'BEGIN TESTE.T1; END;',DBMS_SQL.V7);
   P:=DBMS_SQL.EXECUTE(I);
   INSERT INTO TESTE.LOG VALUES (I,'T1');
   COMMIT;
END;
/
